<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>CasaDelKrogh</title>
 <link href="http://casadelkrogh.dk/atom.xml" rel="self"/>
 <link href="http://casadelkrogh.dk"/>
 <updated>2013-11-28T23:20:44+01:00</updated>
 <id>http://casadelkrogh.dk</id>
 <author>
   <name>Markus Krogh</name>
   <email>markus@casadelkrogh.dk</email>
 </author>

 
 <entry>
   <title>CAS Proxy Tickets</title>
   <link href="http://casadelkrogh.dk/2013/11/28/cas-proxy-tickets"/>
   <updated>2013-11-28T00:00:00+01:00</updated>
   <id>hhttp://casadelkrogh.dk/2013/11/28/cas-proxy-tickets</id>
   <content type="html">&lt;p&gt;This is post that by now is over a year old, but I haven&amp;#8217;t gotten round to post it.&lt;/p&gt;

&lt;p&gt;Back in the summer of 2012 I was looking into how we could provide proxy authentication for our &lt;a href='http://www.jasig.org/cas'&gt;CAS3&lt;/a&gt; installation at work. We were looking into how we could split a traditional front-end, backend, REST service into three separate applications, and still have the backend provide data to the REST service as if it was the user that talked directly to the data source.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;Well time for the post:&lt;/p&gt;

&lt;p&gt;The CAS protocol supports issuing proxy tickets. A proxy ticket is a ticket that allows a CAS protected web application(web-app1) to communicate with another CAS protected web application(web-app2) on behalf of a CAS user.&lt;/p&gt;

&lt;p&gt;Put the other way around, it allows web-app2 to obtain user credentials which are verified by the CAS server. This means that web-app2 will not have to trust web-app1, it only has to trust the CAS server.&lt;/p&gt;

&lt;p&gt;Another example of app to app communication where a user can allow one app to act as himself is OAuth. This exempt taken from the OAuth 2.0 rfc draft explains the purpos a bit better:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The OAuth 2.0 authorization framework enables a third-party application to obtain limited access to an HTTP service, either on behalf of a resource owner by orchestrating an approval interaction between the resource owner and the HTTP service, or by allowing the third-party application to obtain access on its own behalf. - &lt;a href='http://tools.ietf.org/html/draft-ietf-oauth-v2-31'&gt;http://tools.ietf.org/html/draft-ietf-oauth-v2-31&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id='when_to_use_cas_proxy_tickets'&gt;When to use CAS proxy tickets&lt;/h2&gt;

&lt;p&gt;This section will serve as an example of a situation where CAS proxy tickets makes sense. We will look at a scenario where one CAS protected application needs to access another CAS protected service.&lt;/p&gt;

&lt;p&gt;Take a REST resource service that allows some users to edit its resources. Let&amp;#8217;s make it a simple building resource (building-service).&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It contains simple buildings (name, address, coordinates).&lt;/li&gt;

&lt;li&gt;And we have a set of users who are able to edit the building resources (editors).&lt;/li&gt;

&lt;li&gt;The edit/update functionality of the service is protected by CAS, and requires the user to be an editor.&lt;/li&gt;

&lt;li&gt;For the sake of Java we are sticking with an XML data format, but that doesn&amp;#8217;t really matter.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Then we have a simple editing web-app (edit-app), which allows users to edit and create new buildings. This application is quite simple, so simple that some would argue that you could just incorporate it in the building resource service. This way however we will eat our own medicine, it also forces us to think about the data format, and it gives a nice decoupling.&lt;/p&gt;

&lt;p&gt;The app itself:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It fetches building data from the building resource (non-protected)&lt;/li&gt;

&lt;li&gt;It allows users to submit changes to buildings, which it relays to the building&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This setup should probably also have a view part that shows the buildings on a map, but it is irrelevant for this walkthrough.&lt;/p&gt;

&lt;h3 id='communication_flow'&gt;Communication flow&lt;/h3&gt;

&lt;p&gt;The edit-app is protected by CAS, and requires users to login through CAS, and have the role of editor before accessing the app. Handling roles and mapping user names to roles can be injected as a filter, see the resource protection article.&lt;/p&gt;

&lt;p&gt;When the user chooses to save a building the edit-app will try to persist the result using e.g. the &lt;a href='https://jersey.java.net/nonav/documentation/latest/user-guide.html#d4e534'&gt;Jersey client&lt;/a&gt;. This is where CAS proxy tickets come into play:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;The edit-app asks for a proxy granting ticket, see the step by step guide for doing it by hand: &lt;a href='https://wiki.jasig.org/display/CAS/Proxy+CAS+Walkthrough'&gt;CAS Proxy walkthroug&lt;/a&gt; - Please note: In order to get a proxy granting ticket the proxyCallbackUrl must be a https resource, and the check cannot be disabled&lt;/li&gt;

&lt;li&gt;The CAS server then makes a callback to the proxyCallbackUrl (normally on the edit-app) with a proxy ticket.&lt;/li&gt;

&lt;li&gt;With the proxy granting ticket the edit-app asks for a proxy ticket which works for the building-service url.&lt;/li&gt;

&lt;li&gt;This proxy ticket is then appended to the request sent to the building-service as a &lt;code&gt;ticket=ST-72640-rddfeXHeGdbAfM2NEhTD-cas&lt;/code&gt;.&lt;/li&gt;

&lt;li&gt;Upon receiving the proxy ticket along with the edit request the building-service validates the ticket against CAS, and receives the user name.&lt;/li&gt;

&lt;li&gt;The edit-app request is then processed as if the user had made the request directly to the building-service.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The last part is actually what makes the proxy ticket system awesome: You do not have to change your business/authorization code to allow another application to access resources on behalf of a user.&lt;/p&gt;

&lt;p&gt;You do however have to configure the building-service to process proxy tickets, and configure the edit-app service to have a https fronting proxy callback url. That is what the next couple of sections are concerned with.&lt;/p&gt;

&lt;h2 id='requirements'&gt;Requirements&lt;/h2&gt;

&lt;p&gt;To get proxy tickets setup for takeoff you have to meet the following requirements.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;The CAS server must support https verification, more precise it needs to be configured with the &lt;code&gt;HttpBasedServiceCredentialsToPrincipalResolver&lt;/code&gt; and &lt;code&gt;HttpBasedServiceCredentialsAuthenticationHandler&lt;/code&gt;.&lt;/li&gt;

&lt;li&gt;The editor-app must have a https protected callback url available, although the actual app does not have to be protected by https. Note: Jasig recommends that you still use https for all your services, but also states that it is not required other than on the CAS server and the proxy callback.&lt;/li&gt;

&lt;li&gt;The editor-app CAS validation filter must be configured with the proxy callback parameters etc.&lt;/li&gt;

&lt;li&gt;The building-service CAS validation filter must be configured to allow the editor-app to proxy requests (or allow all apps to proxy).&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id='cas_server_configuration'&gt;CAS server configuration&lt;/h3&gt;

&lt;p&gt;As mentioned the CAS server needs to support proxy tickets, the immediate way to support it is to enable the &lt;code&gt;HttpBasedServiceCredentialsToPrincipalResolver&lt;/code&gt; and &lt;code&gt;HttpBasedServiceCredentialsAuthenticationHandler&lt;/code&gt; in the &lt;code&gt;/WEB-INF/deployerConfigContext.xml&lt;/code&gt;. The following snippet shows how it should be wired in (comments omitted):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#/WEB-INF/deployerConfigContext.xml
#...
&amp;lt;property name=&amp;quot;credentialsToPrincipalResolvers&amp;quot;&amp;gt;
  &amp;lt;list&amp;gt;
    #...
    &amp;lt;bean class=&amp;quot;org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver&amp;quot; /&amp;gt;
  &amp;lt;/list&amp;gt;
&amp;lt;/property&amp;gt;
#...
&amp;lt;property name=&amp;quot;authenticationHandlers&amp;quot;&amp;gt;
  &amp;lt;list&amp;gt;
    &amp;lt;bean class=&amp;quot;org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler&amp;quot; p:httpClient-ref=&amp;quot;httpClient&amp;quot;/&amp;gt;
    #...
  &amp;lt;/list&amp;gt;
&amp;lt;/property&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This might not be the only way to configure the CAS server to support proxy tickets, but from a bit of searching it is only way I have found.&lt;/p&gt;

&lt;h2 id='example'&gt;Example&lt;/h2&gt;

&lt;p&gt;Let&amp;#8217;s get down to business. This part will go into gory details on how to configure two simple Java web resources, where one of them can access the other using proxy tickets.&lt;/p&gt;

&lt;p&gt;The apps will be super simple, and will not implement the full reference story.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Start by creating a new project, let&amp;#8217;s call it editor-app.&lt;/li&gt;

&lt;li&gt;Create a servlet and map it to /edit&lt;/li&gt;

&lt;li&gt;Implement a simple doGet method that makes some output (e.g. dispatching to a jsp file)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Code:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/** 
 * Endpoint that makes the request to the building service.
 * {@inheritDoc}
 */
 @Override
 protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
  throws ServletException, IOException {
    
    HashMap&amp;lt;String, Object&amp;gt; model = new HashMap&amp;lt;String, Object&amp;gt;();
    model.put(&amp;quot;secret&amp;quot;, &amp;quot;Ãœber secret&amp;quot;);
    req.setAttribute(&amp;quot;it&amp;quot;, model);     
    RequestDispatcher view  = getServletContext().getRequestDispatcher(&amp;quot;/WEB-INF/jsp/fetcher.jsp&amp;quot;);
    view.forward(req, resp);
 }&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Create that jsp file and make it print out the &lt;code&gt;${it.secret}&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Lets put CAS on that. Add the CAS client jar, along with commons-logging.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Add the default filters to the &lt;code&gt;/WEB-INF/web.xml&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;The snippet below only concerns the CAS Validation Filter, for the other filters please see the attached war in the download section.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Code:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;filter&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;filter-class&amp;gt;org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&amp;lt;/filter-class&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;casServerUrlPrefix&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;https://mkr.aau.dk/cas&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;serverName&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;http://localhost:8080&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;proxyCallbackUrl&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;https://mkr.aau.dk/editor-app/ticket&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;proxyReceptorUrl&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;/ticket&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;
&amp;lt;/filter&amp;gt;

&amp;lt;filter-mapping&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;url-pattern&amp;gt;/edit/*&amp;lt;/url-pattern&amp;gt;
  &amp;lt;url-pattern&amp;gt;/ticket&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;
&amp;lt;filter-mapping&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS Authentication Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;url-pattern&amp;gt;/edit/*&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;
&amp;lt;filter-mapping&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS HttpServletRequest Wrapper Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;url-pattern&amp;gt;/edit/*&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;One of the things to note is the ordering of the filters, some of the explanation is from the &lt;a href='https://wiki.jasig.org/display/CASC/Configuring+the+Jasig+CAS+Client+for+Java+in+the+web.xml'&gt;CAS in web.xml article&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CAS Validation Filter&lt;/code&gt; - Handles both proxy validation and regular validation. Normally you might see this as the second filter.&lt;/li&gt;

&lt;li&gt;&lt;code&gt;CAS Authentication Filter&lt;/code&gt; - Detects whether a user needs to be authenticated or not. It will redirect to CAS if needed.&lt;/li&gt;

&lt;li&gt;&lt;code&gt;CAS HttpServletRequest Wrapper Filter&lt;/code&gt; - Wraps an HttpServletRequest so that the getRemoteUser and getPrincipal return the CAS related entries.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If we take a closer look at the options specified for the &lt;code&gt;CAS Validation Filter&lt;/code&gt; we have added two optional init-params.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;proxyCallbackUrl&lt;/code&gt; - Used to tell the CAS server where it should make its callback containing the proxy granting ticket, this url must point to an https protected url. If it does not the CAS server will not supply the proxy ticket on the callback.&lt;/li&gt;

&lt;li&gt;&lt;code&gt;proxyReceptorUrl&lt;/code&gt; - The URL to watch for PGTIOU/PGT responses from the CAS server. This should be defined from the root of the context.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In this example the &lt;code&gt;proxyCallbackUrl&lt;/code&gt; is pointing to &lt;code&gt;https://mkr.aau.dk&lt;/code&gt; which is a bogus address, which I spoof in the host file on my local machine, and have a &lt;strong&gt;valid&lt;/strong&gt; certificate for. To get this to work, I have deployed a local version of the CAS server so that I can spoof the &lt;code&gt;mkr.aau.dk&lt;/code&gt; address. I could also have registered the address in DNS and opened the correct ports on my machine etc. The ssl certificate is managed by an Apache I have running, since it was easier for me to set up ssl in Apache than in Tomcat.&lt;/p&gt;

&lt;p&gt;As mentioned there might be other ways to get a proxy granting ticket but I have not been able to pinpoint it. Perhaps it is possible to register your app and get a API/Auth key you can present to the CAS server authenticate your service.&lt;/p&gt;

&lt;p&gt;Now we should be able to get a proxy granting ticket \o/, let&amp;#8217;s see if it works.&lt;/p&gt;

&lt;h3 id='obtaining_proxy_tickets'&gt;Obtaining proxy tickets&lt;/h3&gt;

&lt;p&gt;In Java you can use the CAS Assertion (user principal wrapper object) to obtain proxy tickets, so let&amp;#8217;s add the following to our &lt;code&gt;doGet&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;AttributePrincipal principal = (AttributePrincipal)req.getUserPrincipal();
String proxyTicket = principal.getProxyTicketFor(&amp;quot;http://localhost:8080/building-service/&amp;quot;);
model.put(&amp;quot;proxy_ticket&amp;quot;, proxyTicket);&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;What it does is get the AttributePrincipal and ask it for a proxy ticket for a specific url. We put that ticket into our it variable and print it on our jsp page(not really something you would ever do).&lt;/p&gt;

&lt;p&gt;If we deploy this project we should see some tickets e.g. &lt;code&gt;ST-5-WGciSIlId5IRKvJoWdsD-cas&lt;/code&gt;. As a note CAS3 does not seem to indicate a difference between service tickets and proxy tickets, older versions used to prefix proxy tickets with &lt;code&gt;PT&lt;/code&gt; and service tickets with &lt;code&gt;ST&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id='creating_the_buildingservice'&gt;Creating the building-service&lt;/h3&gt;

&lt;p&gt;Start a new servlet project and name it building-service. Then create a servlet that has a doPost method and map it to &lt;code&gt;/&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
  HashMap&amp;lt;String, Object&amp;gt; model = new HashMap&amp;lt;String, Object&amp;gt;();
  
  String msg = request.getParameter(&amp;quot;msg&amp;quot;);
  
  if(&amp;quot;GiefSecret&amp;quot;.equalsIgnoreCase(msg)){
    model.put(&amp;quot;secret&amp;quot;, &amp;quot;There is no secret.&amp;quot;);
  }
  
  request.setAttribute(&amp;quot;it&amp;quot;, model);   
  RequestDispatcher view  = getServletContext().getRequestDispatcher(&amp;quot;/WEB-INF/jsp/secret.jsp&amp;quot;);
  view.forward(request, response);
}&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;secret.jsp&lt;/code&gt; view only renders a small piece of text and the secret if present. We need to protect this with CAS as well so go ahead and add the following to the web.xml file:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;filter&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;filter-class&amp;gt;org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&amp;lt;/filter-class&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;casServerUrlPrefix&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;https://mkr.aau.dk/cas&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;serverName&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;http://localhost:8080&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;allowedProxyChains&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;https://mkr.aau.dk/editor-app/ticket&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;
  &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;redirectAfterValidation&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;false&amp;lt;/param-value&amp;gt;
  &amp;lt;/init-param&amp;gt;    
&amp;lt;/filter&amp;gt;

&amp;lt;filter-mapping&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS Validation Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;
&amp;lt;filter-mapping&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS Authentication Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;
&amp;lt;filter-mapping&amp;gt;
  &amp;lt;filter-name&amp;gt;CAS HttpServletRequest Wrapper Filter&amp;lt;/filter-name&amp;gt;
  &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Again only the &lt;code&gt;CAS Validation Filter&lt;/code&gt; is included here as it has some extra parameters:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;allowedProxyChains&lt;/code&gt; - Specify which web apps are allowed to proxy requests to the service. This value should be the same as the proxyCallbackUrl specified in the editor-app.&lt;/li&gt;

&lt;li&gt;&lt;code&gt;redirectAfterValidation&lt;/code&gt; - This one determines whether or not CAS should redirect after validating a request, if set to &lt;code&gt;true&lt;/code&gt; it will throw away any request parameters given. So remember to set it to &lt;code&gt;false&lt;/code&gt; if you need to send parameters to the building-service.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It is also possible to use the &lt;code&gt;acceptAnyProxy&lt;/code&gt; parameter which will allow any service to proxy requests to the building-service.&lt;/p&gt;

&lt;p&gt;With this in place we can now return to the editor-app and make the call to the building-service. Because I&amp;#8217;m quite lazy I prefer to use the jersey client to make http requests rather than &lt;code&gt;java.net.URL&lt;/code&gt;. So we add the jersey-bundle to the editor-app for simplicity. Again in our doGet method let&amp;#8217;s make it look like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;protected void doGet(HttpServletRequest req, HttpServletResponse resp)
throws ServletException, IOException {
  HashMap&amp;lt;String, Object&amp;gt; model = new HashMap&amp;lt;String, Object&amp;gt;();
  
  AttributePrincipal principal = (AttributePrincipal)req.getUserPrincipal();
  String proxyTicket = principal.getProxyTicketFor(BUILDING_SERVICE_URL);
  model.put(&amp;quot;proxy_ticket&amp;quot;, proxyTicket);
  
  Client client = Client.create(new DefaultClientConfig());
  WebResource webreq =  client.resource(BUILDING_SERVICE_URL);
  
  String secret = webreq.queryParam(&amp;quot;ticket&amp;quot;, proxyTicket).queryParam(&amp;quot;msg&amp;quot;, &amp;quot;GiefSecret&amp;quot;).post(String.class);
  model.put(&amp;quot;secret&amp;quot;, secret);
     
  req.setAttribute(&amp;quot;it&amp;quot;, model);
  RequestDispatcher view  = getServletContext().getRequestDispatcher(&amp;quot;/WEB-INF/jsp/fetcher.jsp&amp;quot;);
  view.forward(req, resp);
}&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now we should be able to deploy both apps and see the correct messages.&lt;/p&gt;

&lt;p&gt;Congratulations you are now able to use proxy tickets, awesome? Yes indeed&amp;#8230;&lt;/p&gt;

&lt;h2 id='other_thoughts'&gt;Other thoughts&lt;/h2&gt;

&lt;p&gt;Going over the example again I can&amp;#8217;t help but think that it might be possible to use another service as the proxy callback. This would make it possible to have a central proxy ticket resource that based on a proxy ticket IOU could return the proxy ticket returned from the CAS server. However this would not work with the current CAS Java filters, as they rely on finding the proxy ticket within the same application.&lt;/p&gt;

&lt;p&gt;I&amp;#8217;m also still weary on why the proxy granting is done as it is, because it requires additional ssl certificates for each application that needs proxy access. Given that the trust is explicitly on the CAS server, the only reason for the callback is so that I cannot setup a man in the middle service that gets a proxy ticket and accesses some other services. But this trust only goes as far as a valid ssl certificate and a dns spoof. And given that the backend service can define which services are allowed to do proxy requests I cannot see why the proxy ticket cannot be part of the initial reply to the editor-app.&lt;/p&gt;

&lt;p&gt;Well that again depends on whether or not the CAS server tells the building-service which service it was that requested the proxy ticket. Then perhaps it makes sense, as the building-service then knows from a trusted source which service is doing the proxying. This would then require that the CAS server must know which service is requesting the proxy ticket, and therefore it must require the superficial validation by doing a callback, which have to be over https to make sure that the proxy ticket is not sniffed&amp;#8230; Hmm that might actually be why the call back needs to be made.&lt;/p&gt;

&lt;p&gt;As I mentioned it might be possible to go with a basic auth solution where the editor-service is authenticated by an API key, and thus the CAS server does not need to make a callback to verify the service.&lt;/p&gt;

&lt;p&gt;Other relevant resources on CAS and proxy authentication:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The CAS protocol &lt;a href='http://www.jasig.org/cas/protocol'&gt;http://www.jasig.org/cas/protocol&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id='download_example'&gt;Download example&lt;/h2&gt;

&lt;p&gt;The example apps created in this article can be downloaded as: &lt;a href='/files/CAS_Proxy_Tickets-example.zip'&gt;CAS_Proxy_Tickets-example.zip&lt;/a&gt;&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Battling the asset pipeline</title>
   <link href="http://casadelkrogh.dk/code/2013/11/08/battling-the-asset-pipeline"/>
   <updated>2013-11-08T00:00:00+01:00</updated>
   <id>hhttp://casadelkrogh.dk/code/2013/11/08/battling-the-asset-pipeline</id>
   <content type="html">&lt;p&gt;About half a year ago I had to update a rails 3.1 application to 3.2. With the upgrade my &lt;a href='http://sass-lang.com/'&gt;Sass&lt;/a&gt; and &lt;a href='http://coffeescript.org/'&gt;CoffeScript&lt;/a&gt; auto-compilation ended up being botched.&lt;/p&gt;

&lt;p&gt;This prompted me to change to the asset pipeline, which in itself proved to be a bit like &lt;a href='http://imgur.com/t0XHtgJ'&gt;yak shaving&lt;/a&gt;, fixing one thing only to have a new bug appear.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;One of my primary resources for enabling the asset pipeline was Ryan Bats excellent rails cast about &lt;a href='http://asciicasts.com/episodes/282-upgrading-to-rails-3-1'&gt;upgrading to 3.1&lt;/a&gt;. It helps you get a basic asset pipeline setup.&lt;/p&gt;

&lt;p&gt;The standard asset pipeline configuration in rails only covers &lt;code&gt;application.js&lt;/code&gt; and &lt;code&gt;application.css&lt;/code&gt;, and I needed to add a couple of extra files. One way to do this is to add them to the &lt;code&gt;config.assets.precompile&lt;/code&gt; array.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[&amp;#39;main.css&amp;#39;, &amp;#39;editor.js&amp;#39;, &amp;quot;indgang.js&amp;quot;].each do |asset|
  config.assets.precompile &amp;lt;&amp;lt; asset
end&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The problem is that in development mode the asset pipeline is turned off, and Rails serves the assets directly. This means you will not discover the error until deploying to production, where Rails throws a nasty &amp;#8220;asset not pre-compiled&amp;#8221; exception.&lt;/p&gt;

&lt;h2 id='images_and_sass'&gt;Images and Sass&lt;/h2&gt;

&lt;p&gt;Another small problem I faced was that images included from Sass was not showing up. This was fixed by moving the images to &lt;code&gt;app/assets/images&lt;/code&gt; and using the &lt;code&gt;image-url&lt;/code&gt; Sass helper.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;.some-class
  image-url(&amp;#39;bord-top.gif&amp;#39;)&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;It will refer to the correct image path for images placed in &lt;code&gt;app/assets/images&lt;/code&gt;.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Coffee</title>
   <link href="http://casadelkrogh.dk/Other/2013/10/04/coffee"/>
   <updated>2013-10-04T00:00:00+02:00</updated>
   <id>hhttp://casadelkrogh.dk/Other/2013/10/04/coffee</id>
   <content type="html">&lt;p&gt;Yesterday my new coffee grinder arrived. It is a &lt;a href='http://www.imerco.dk/Default.aspx?id=6171&amp;amp;ProductID=100329983'&gt;Bodum Bistro&lt;/a&gt; electric grinder that uses a conical burr grinder. For quite some time I have considered buying a coffee grinder.&lt;/p&gt;

&lt;p&gt;It all started when I bought my &lt;a href='http://www.amazon.co.uk/Aerobie-AeroPress-80R08-Coffee-Maker/dp/B000GXZ2GS/'&gt;Aero Press&lt;/a&gt;. A couple of my friends had been praising it, and when I discovered that it was as cheap as it is I was sold.&lt;/p&gt;
&lt;!--more--&gt;&lt;img alt='coffee.jpg' class='right' src='/images/coffee/coffee.jpg' /&gt;
&lt;p&gt;That was what got me started on my coffee adventure. Because I do not drink coffee by the bucket I started buying different brands of luxury coffee. It was nice and all was dandy, as time went by I began to think about grinding the coffee myself to keep it fresh.&lt;/p&gt;

&lt;p&gt;A couple of half hearted searches on amazon and a trip to city center yielded nothing really interesting. Then one night I was over at a friends apartment and he offered me a cup of freshly ground coffee; who would not want that?&lt;/p&gt;

&lt;p&gt;He mentioned that Imerco had an offer up for package with a coffee grinder and a French press. Their web shop did not have it in stock, but mentioned that some stores might still have some left. That prompted me to visit the two local shops with no luck what so ever.&lt;/p&gt;

&lt;p&gt;A week later I fortunately managed to order the set from the web shop. Because it was still out of stock it took over a fortnight for them to fulfill the order. But after a quick email exchange they polled around some of their shops and found a set for me \o/.&lt;/p&gt;

&lt;p&gt;As an added bonus to this waiting game, the French press was dead on arrival as the glass was cracked.&lt;/p&gt;

&lt;p&gt;But here I am writing a quick post whilst drinking a cup of coffee made on my aero press from my freshly ground coffee. Mmmmm.&lt;/p&gt;
&lt;div class='slider'&gt;
&lt;ul class='inner'&gt;
&lt;li class='item'&gt;&lt;img alt='Bodum_Bistro.jpg' src='/images/coffee/Bodum_Bistro.jpg' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='coffee.jpg' src='/images/coffee/coffee.jpg' /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;</content>
 </entry>
 
 <entry>
   <title>Tracking time</title>
   <link href="http://casadelkrogh.dk/code/2013/06/09/tracking-time"/>
   <updated>2013-06-09T00:00:00+02:00</updated>
   <id>hhttp://casadelkrogh.dk/code/2013/06/09/tracking-time</id>
   <content type="html">&lt;p&gt;In response to recent rule changes at work, and my desire to take a crack at using requirejs for something usefull, I have created a simple punch-clock javascript app that can help me track time spent.&lt;/p&gt;

&lt;p&gt;There are a lot of apps out there to track time, and a lot of them are quite nice, but &amp;#8220;not invented here&amp;#8221; has not been coined in vain. Due to the relative low complexity of the problem I decided to DIY it and created &lt;a href='http://punch-clock.boundless.dk'&gt;punch-clock&lt;/a&gt;.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 id='motivation'&gt;Motivation&lt;/h2&gt;

&lt;p&gt;Recently at work we have been instructed to register our over and under time. Previously we have had a &amp;#8220;rule&amp;#8221; that it was up to ourselves to keep track of our time, as long as we did not exceed two work days. It has worked fine and generally been pleasant, but as AAU have begun to centralize all IT resources, a set of ground rules have been laid out.&lt;/p&gt;

&lt;p&gt;Unfortunately that means I now have to report my over/under time. One of the things I am notoriously bad at is time calculations, but then I can &amp;#8220;create an app for that&amp;#8221;&amp;#8482;&lt;/p&gt;

&lt;h2 id='enter_punchclock'&gt;Enter punch-clock&lt;/h2&gt;
&lt;img alt='punch_clock.png' class='right' src='/images/punch-clock/punch_clock.png' /&gt;
&lt;p&gt;Punch clock is a simple check-in, check-out app that calculates the time spent. When a check-in is created it will keep the duration up to date as time passes. Finally when checking out it will display start and stop time, and the duration.&lt;/p&gt;

&lt;p&gt;At the moment it stores check-in/outs in the browsers local storage. This means you can check-in, close the page/browser and return later to check-out/see progress.&lt;/p&gt;

&lt;p&gt;That is all the app supports by now, I know quite simple, that is what is nice about it.&lt;/p&gt;

&lt;h2 id='approach'&gt;Approach&lt;/h2&gt;

&lt;p&gt;I decided to use &lt;a href='http://requirejs.org/'&gt;require.js&lt;/a&gt; to allow me to modularize my code, then I added &lt;a href='http://pivotal.github.io/jasmine/'&gt;jasmine&lt;/a&gt; for testing, and decided on using &lt;a href='http://momentjs.com/'&gt;moment.js&lt;/a&gt; for time manipulation.&lt;/p&gt;

&lt;p&gt;The source files are split up into somewhat simple modules. I have created models, services, presenters, views and more. This gives a natural belonging of each module and makes it easier to approach.&lt;/p&gt;

&lt;p&gt;Punch-clock is structured as a Model-View-NotReallyAnyControllersButSomeServicesAndObservers. This means that the views handles both changing the DOM and DOM interactions. Views listens/observes/subscribes to service and model events and updates the DOM accordingly.&lt;/p&gt;

&lt;p&gt;Each time a new check-in is added the service emits an event, which the different views respond to buy updating. This makes the views very flexible, and encourages splitting up views into small modules that only handle one thing. I have the following views:&lt;/p&gt;
&lt;dl&gt;
  &lt;dt&gt;Check-in&lt;/dt&gt;
  &lt;dd&gt;Handles check-in/out buttons.&lt;/dd&gt;
  &lt;dt&gt;Status&lt;/dt&gt;
  &lt;dd&gt;Updates the main textual status.&lt;/dd&gt;
  &lt;dt&gt;Cleanup&lt;/dt&gt;
  &lt;dd&gt;Handles cleanup button and count.&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Even the local storage backed is created by wrapping the simple service and listening on changes on both the service and the individual model objects. When a change occurs it simply serializes the entire simple service to JSON and stores it.&lt;/p&gt;

&lt;h2 id='testing'&gt;Testing&lt;/h2&gt;

&lt;p&gt;At the time I started writing code for punch-clock I was reading &lt;a href='http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882'&gt;clean code&lt;/a&gt; by Uncle Bob. But I must admit that my models are a hideous blend of data-structures and real objects. This however lead me to take a hard look at my code and pushed me to try to structure my code to make it testable.&lt;/p&gt;

&lt;p&gt;Normally when I write code most of my view code tends not to be testable, in this little app I have tried to remedy that. So far all my views has tests, and adding new tests are quite simple. One might simply disregard this as punch-clock being a rather simple app, which is true, but surprisingly DOM interactions can be made quite testable, with a little work.&lt;/p&gt;

&lt;p&gt;In general the views can take a DOM-node which they will use instead of the page DOM. This means that in tests you can create a simple DOM structure and check it for changes the view should have performed. Furthermore you do not have to worry about cleaning up the page DOM after a test has run.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var $test, service;
var view;
beforeEach(function(){
  $test = DomCreator(&amp;quot;div h2.punch-clock&amp;quot;);
  service = TimeSpanService.create();
  view = StatusView.create(service, $test); 
});&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The above code is an example of how the DOM can be &amp;#8220;mocked&amp;#8221; you can then check it for changes:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;it(&amp;quot;updates status when adding time spans&amp;quot;, function(){
  expect($test.textContent).toEqual(&amp;quot;&amp;quot;);
  service.addNew();
  expect($test.textContent).toContain(&amp;quot;Check-in at&amp;quot;);
});&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally using jasmine you can mock out time dependencies, which allows you to test timeout functions.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;it(&amp;quot;should update accordingly&amp;quot;, function(){
  service.addNew();
  var before = $test.textContent;

  //Move start 3min back in time :D
  service.first().start().subtract(3, &amp;quot;minutes&amp;quot;);

  jasmine.Clock.tick(30001);
  expect($test.textContent).not.toEqual(before);
});&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Yep I am aware of that nasty change the time hack that does not obey the &lt;a href='http://en.wikipedia.org/wiki/Law_of_Demeter'&gt;Law of Demeter&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id='the_future'&gt;The future&lt;/h2&gt;

&lt;p&gt;Right now punch-clock is quite basic. It supports my basic needs, but there are some immediate functions I would like to add:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;History - the ability to see previous check-ins.&lt;/li&gt;

&lt;li&gt;Check-in url paramter - allow you to bookmark a auto check-in so you can add it to your startup pages on your work machine.&lt;/li&gt;

&lt;li&gt;Edit - edit check-ins&lt;/li&gt;

&lt;li&gt;Categories - or tags e.g. work, training etc.&lt;/li&gt;

&lt;li&gt;Delete - delete individual check-ins&lt;/li&gt;

&lt;li&gt;Save to web-service - e.g. simple backend, gists, google drive.&lt;/li&gt;

&lt;li&gt;Check-in on multiple devices using a unique indentifier.. email?&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;There is probably a lot of other things that makes sense to add, or not to add.&lt;/p&gt;

&lt;p&gt;The source can be found at: &lt;a href='https://github.com/mkrogh/punch-clock'&gt;github&lt;/a&gt;, and the app is running at &lt;a href='http://punch-clock.boundless.dk/'&gt;punch-clock&lt;/a&gt;.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Colors... in vim</title>
   <link href="http://casadelkrogh.dk/2013/05/02/colors-in-vim"/>
   <updated>2013-05-02T00:00:00+02:00</updated>
   <id>hhttp://casadelkrogh.dk/2013/05/02/colors-in-vim</id>
   <content type="html">&lt;p&gt;Today at work I sat down to create a small automatic pull-deploy shell script. I fired up vim on a development server and nearly had my eyes torn out. The default theme for vim is bad, well at least I do not like the way that you cannot see comments (dark blue on a black background does not really work).&lt;/p&gt;

&lt;p&gt;At home my &lt;code&gt;.vimrc&lt;/code&gt; sets up my colorscheme, but I could not remember which I tend to use. I tried to seach online for some proper screenshots of the differnt themes in vim, but could not find any good comparison/gallery.&lt;/p&gt;

&lt;p&gt;That is why I decided to make a bunch of screenshots of vim themes sporting different code snippets.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;The reason to do screenshots of different languages as well as the themes were that as I made the first batch of bash screenshots I opened a JavaScript file. It was totally different to look at, so I opned a ruby file, and a CSS file. All varied to some degree so I decided to create a bunch of extra screenshots.&lt;/p&gt;

&lt;h3 id='shell'&gt;Shell&lt;/h3&gt;
&lt;div class='slider'&gt;
&lt;ul class='inner'&gt;
&lt;li class='item'&gt;&lt;img alt='blue-sh-vim.png' src='/images/vim-themes/sh/blue-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='darkblue-sh-vim.png' src='/images/vim-themes/sh/darkblue-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='default-sh-vim.png' src='/images/vim-themes/sh/default-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='delek-sh-vim.png' src='/images/vim-themes/sh/delek-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='desert-sh-vim.png' src='/images/vim-themes/sh/desert-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='elflord-sh-vim.png' src='/images/vim-themes/sh/elflord-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='evening-sh-vim.png' src='/images/vim-themes/sh/evening-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='koehler-sh-vim.png' src='/images/vim-themes/sh/koehler-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='morning-sh-vim.png' src='/images/vim-themes/sh/morning-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='murphy-sh-vim.png' src='/images/vim-themes/sh/murphy-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='pablo-sh-vim.png' src='/images/vim-themes/sh/pablo-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='peachpuff-sh-vim.png' src='/images/vim-themes/sh/peachpuff-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='ron-sh-vim.png' src='/images/vim-themes/sh/ron-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='shine-sh-vim.png' src='/images/vim-themes/sh/shine-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='slate-sh-vim.png' src='/images/vim-themes/sh/slate-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='torte-sh-vim.png' src='/images/vim-themes/sh/torte-sh-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='zellner-sh-vim.png' src='/images/vim-themes/sh/zellner-sh-vim.png' /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id='ruby'&gt;Ruby&lt;/h3&gt;
&lt;div class='slider'&gt;
&lt;ul class='inner'&gt;
&lt;li class='item'&gt;&lt;img alt='blue-ruby-vim.png' src='/images/vim-themes/ruby/blue-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='darkblue-ruby-vim.png' src='/images/vim-themes/ruby/darkblue-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='default-ruby-vim.png' src='/images/vim-themes/ruby/default-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='delek-ruby-vim.png' src='/images/vim-themes/ruby/delek-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='desert-ruby-vim.png' src='/images/vim-themes/ruby/desert-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='elflord-ruby-vim.png' src='/images/vim-themes/ruby/elflord-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='evening-ruby-vim.png' src='/images/vim-themes/ruby/evening-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='koehler-ruby-vim.png' src='/images/vim-themes/ruby/koehler-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='morning-ruby-vim.png' src='/images/vim-themes/ruby/morning-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='murphy-ruby-vim.png' src='/images/vim-themes/ruby/murphy-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='pablo-ruby-vim.png' src='/images/vim-themes/ruby/pablo-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='peachpuff-ruby-vim.png' src='/images/vim-themes/ruby/peachpuff-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='ron-ruby-vim.png' src='/images/vim-themes/ruby/ron-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='shine-ruby-vim.png' src='/images/vim-themes/ruby/shine-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='slate-ruby-vim.png' src='/images/vim-themes/ruby/slate-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='torte-ruby-vim.png' src='/images/vim-themes/ruby/torte-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='zellner-ruby-vim.png' src='/images/vim-themes/ruby/zellner-ruby-vim.png' /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id='javascript'&gt;Javascript&lt;/h3&gt;
&lt;div class='slider'&gt;
&lt;ul class='inner'&gt;
&lt;li class='item'&gt;&lt;img alt='blue-js-vim.png' src='/images/vim-themes/js/blue-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='darkblue-js-vim.png' src='/images/vim-themes/js/darkblue-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='default-js-vim.png' src='/images/vim-themes/js/default-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='delek-js-vim.png' src='/images/vim-themes/js/delek-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='desert-vim.png' src='/images/vim-themes/js/desert-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='elflord-js-vim.png' src='/images/vim-themes/js/elflord-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='evening-vim.png' src='/images/vim-themes/js/evening-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='koehler-js-vim.png' src='/images/vim-themes/js/koehler-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='morning-js-vim.png' src='/images/vim-themes/js/morning-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='murphy-js-vim.png' src='/images/vim-themes/js/murphy-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='pablo-js-vim.png' src='/images/vim-themes/js/pablo-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='peachpuff-js-vim.png' src='/images/vim-themes/js/peachpuff-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='ron-js-vim.png' src='/images/vim-themes/js/ron-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='shine-js-vim.png' src='/images/vim-themes/js/shine-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='slate-js-vim.png' src='/images/vim-themes/js/slate-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='torte-js-vim.png' src='/images/vim-themes/js/torte-js-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='zellner-js-vim.png' src='/images/vim-themes/js/zellner-js-vim.png' /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h3 id='css'&gt;CSS&lt;/h3&gt;
&lt;div class='slider'&gt;
&lt;ul class='inner'&gt;
&lt;li class='item'&gt;&lt;img alt='blue-css-vim.png' src='/images/vim-themes/css/blue-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='darkblue-css-vim.png' src='/images/vim-themes/css/darkblue-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='default-css-vim.png' src='/images/vim-themes/css/default-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='delek-css-vim.png' src='/images/vim-themes/css/delek-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='desert-css-vim.png' src='/images/vim-themes/css/desert-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='elflord-css-vim.png' src='/images/vim-themes/css/elflord-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='evening-css-vim.png' src='/images/vim-themes/css/evening-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='koehler-css-vim.png' src='/images/vim-themes/css/koehler-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='morning-css-vim.png' src='/images/vim-themes/css/morning-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='murphy-css-vim.png' src='/images/vim-themes/css/murphy-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='pablo-css-vim.png' src='/images/vim-themes/css/pablo-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='peachpuff-css-vim.png' src='/images/vim-themes/css/peachpuff-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='ron-css-vim.png' src='/images/vim-themes/css/ron-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='shine-css-vim.png' src='/images/vim-themes/css/shine-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='slate-css-vim.png' src='/images/vim-themes/css/slate-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='torte-css-vim.png' src='/images/vim-themes/css/torte-css-vim.png' /&gt;&lt;/li&gt;
&lt;li class='item'&gt;&lt;img alt='zellner-css-vim.png' src='/images/vim-themes/css/zellner-css-vim.png' /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;</content>
 </entry>
 
 <entry>
   <title>Diving for Dahab</title>
   <link href="http://casadelkrogh.dk/2013/02/27/diving-for-dahab"/>
   <updated>2013-02-27T00:00:00+01:00</updated>
   <id>hhttp://casadelkrogh.dk/2013/02/27/diving-for-dahab</id>
   <content type="html">&lt;p&gt;A mate and I are planning a trip to Dahab (Egypt) in late March.&lt;/p&gt;

&lt;p&gt;We stumbled upon an offer from kilroy travels where you could get 7 days in Dahab, including a PADI Open Water certification for about &lt;a href='https://www.google.dk/search?q=3700+dkk+in+usd'&gt;3700 dkk&lt;/a&gt;. This was a nice offer, and all we had to do was book the flight. Well at least so we thought.&lt;/p&gt;

&lt;p&gt;After we bought the tickets from Copenhagen to Sharm El Sheikh, we recieved an offer from kilroy for diving in Sharm El Sheikh, not Dahab, and it was suddenly &lt;a href='https://www.google.dk/search?q=4600+dkk+in+usd'&gt;4600 dkk&lt;/a&gt; rather than the aforementioned 3700 dkk.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;When we recieved this &amp;#8220;offer&amp;#8221; we were a bit perplexed. When we looked at &lt;a href='http://www.kilroy.dk/'&gt;kilroy.dk&lt;/a&gt; the offer on Diving in Dahab was gone. This made us a bit uneasy and we wrote to the travelagent that had sent us the offer. It turned out that the Dive center in Dahab with wich they had an agreement was undergoing rennovations, and the travel agent then had assumed that we then rather would like to dive in Sharm El Sheikh.&lt;/p&gt;

&lt;p&gt;This was not what we had anticipated.. We had already booked the flight ourselves, and planned the time off for the holiday, so we decided to take a look at booking diving and hotel in Dahab ourselves.&lt;/p&gt;

&lt;p&gt;We looked at different hotels in Dahab using &lt;a href='http://www.tripadvisor.com'&gt;tripadvisor&lt;/a&gt; and &lt;a href='http://www.booking.com'&gt;booking.com&lt;/a&gt;. And quickly boiled it down to three hotels: the &lt;a href='http://starofdahab.com/'&gt;Star of Dahab&lt;/a&gt;, the &lt;a href='http://www.dahabdivers.com/start.htm'&gt;Dahab Divers&lt;/a&gt;, and as backup the &lt;a href='http://www.mirage.com.eg/'&gt;Mirage village&lt;/a&gt;. All were available, and it was even possible to get two single rooms (I snore quite a lot).&lt;/p&gt;

&lt;p&gt;We ended up choosing Star of Dahab, as it seemed nice and cozy, and near most of the dive centers. Or at least we reserved two rooms there, but they might be subject to change (dahab divers looks so nice).&lt;/p&gt;

&lt;p&gt;In order to cover the diving we wrote to three diving centers: &lt;a href='http://www.bigbluedahab.com/'&gt;Big Blue Dahab&lt;/a&gt;, &lt;a href='http://www.h2odiversdahab.com/'&gt;H2O divers&lt;/a&gt; and &lt;a href='http://www.poseidondivers.com/'&gt;Poseidon Divers&lt;/a&gt;. Again these dive centers were chosen based on reviews on tripadvisor and comments on booking.com.&lt;/p&gt;

&lt;p&gt;All of the three dive centers replied within 12 hours which was awesome! All were super nice, and all actually answered our enquries, and added additional information. Currently we have not decided on which dive center we are going to use. But I am leaning towards Big Blue Dahab or H2O.&lt;/p&gt;

&lt;p&gt;As of now it seems like we are approaching 3600 dkk for staying at Dahab. However this is with seperate bedrooms and two extra days included in the price. Thats pretty good for using a couple of afternoons, in short if you do not buy a packaged trip, you should probably check out if it makes sense to book it all yourself.&lt;/p&gt;

&lt;p&gt;I will probably be posting a couple of posts soon on what we end up choosing, and how the trip goes.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Treasures on rails</title>
   <link href="http://casadelkrogh.dk/code/2012/11/01/treasures-on-rails"/>
   <updated>2012-11-01T00:00:00+01:00</updated>
   <id>hhttp://casadelkrogh.dk/code/2012/11/01/treasures-on-rails</id>
   <content type="html">&lt;p&gt;In my spare time I am the chairman of a netparty society called &lt;a href='http://www.nanolaug.dk'&gt;Nanolaug&lt;/a&gt;. Twice a year we organize a Netparty for about 80 people. Normally we have 2-3 combos and every now and then a fun-combo.&lt;/p&gt;

&lt;p&gt;For a recent party I decided to host a fun-combo consisting of a digital &lt;a href='https://treasure.nanolaug.dk'&gt;treasure hunt&lt;/a&gt;.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;The idea came after participating in &lt;a href='http://thecamp.dk' title='Danish only'&gt;The Camp&lt;/a&gt; 2012, where ptrf hosted a digital treasurehunt. The goal was to collect the most gold (md5 sums) by solving differnt puzzles, most having something to do with computer science. To find the puzzles you had to look for clues hidden on different webpages. The treasure hunt from the camp was inspired by the &lt;a href='http://treasure.pwnies.dk'&gt;the pwnies&lt;/a&gt; site (it was actually a clone of it).&lt;/p&gt;

&lt;p&gt;As mentioned I decided to host a treasure hunt, but I chose to make it a bit simpler. Mostly because people participating in a netparty are not that proficient in crackmes, decrypting, and general programming language obscurity.&lt;/p&gt;

&lt;h2 id='the_case'&gt;The case&lt;/h2&gt;

&lt;p&gt;A simple digital treasure hunt consists of gold and maps. I chose to represent gold and maps as a sha1 sum in hex, to differentiate between the two I chose to reperesent them as:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;GOLD-7b07fa2a6abcb72f56543e5fc9f4946ea15cf5bc-END&lt;/code&gt;&lt;/li&gt;

&lt;li&gt;&lt;code&gt;MAP-945fa9bc3027d7025e3de4a72fcfe7077bfbfaf9-END&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Maps are used to find different puzzles, and locate more gold. They consist of a title, some text and of cause a sha1sum(key). Some maps are hidden within the pages and the resources (css, js, etc).&lt;/p&gt;

&lt;p&gt;Gold is finite and can be registered in a &amp;#8220;bank account&amp;#8221;, or rater it can be claimed. The more gold you have claimed the higher your score will be on the central score board.&lt;/p&gt;

&lt;p&gt;To spice it up a bit I added the possiblity to create a series of questions. Each correct answer is rewarded with a pice of gold and a new question (if there are anymore). Answers to questions are implemented as regular expresseions, which allows you to accept multiple answers as correct.&lt;/p&gt;

&lt;h2 id='manage_it'&gt;Manage it&lt;/h2&gt;

&lt;p&gt;In order to manage it all I created a simple CRUD interface protected by omniauth. As something new I decided to make a mailer that sends me (the admin) a mail when someone without access tries to log into the manager interface. This way I did not have to make an explicit signup procedure, see: &lt;a href='https://gist.github.com/mkrogh/3995995'&gt;https://gist.github.com/mkrogh/3995995&lt;/a&gt;&lt;/p&gt;

&lt;h2 id='the_end'&gt;The end&lt;/h2&gt;

&lt;p&gt;There probably was an end to this post but I ended up beeing to drunk to write it, or I ran out of power on the laptop.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Netgear N300 WNR3500L v1 custom firmware</title>
   <link href="http://casadelkrogh.dk/hardware/2012/08/25/netgear-n300-wnr3500l-v1-custom-firmware"/>
   <updated>2012-08-25T00:00:00+02:00</updated>
   <id>hhttp://casadelkrogh.dk/hardware/2012/08/25/netgear-n300-wnr3500l-v1-custom-firmware</id>
   <content type="html">&lt;p&gt;For years I have had a Netgear N300 router which has served me well, but it has been lacking several features, one of which is local DNS entries.&lt;/p&gt;

&lt;p&gt;After a recent firmware update it had become somewhat unstable, dropping the internet connection, thus requireing a manual restart at times.&lt;/p&gt;

&lt;p&gt;I therefore decided that I wanted to change to a custom firmware, and the choice landed on the tomato firmware. This post will try to recount the journey of upgrading my router.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;Another reason for this post is that I could not find any coherent account on how to do firmware upgrades of my &amp;#8220;open-source&amp;#8221; N300 router. All the resources were scattered and the one step by step guide I found did not explain everything.&lt;/p&gt;

&lt;h2 id='choosing_a_firmware'&gt;Choosing a firmware&lt;/h2&gt;

&lt;p&gt;There are several router firmwares out there, but not all are prepared to run on the WNR3500l. I found a list on myopenrouter that lists the currently &amp;#8220;supported&amp;#8221; &lt;a href='http://www.myopenrouter.com/download/list?sort=date&amp;amp;cat=44'&gt;firmwares&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Given that the only firmwares that seemed to be regualarly update are &lt;a href='http://www.dd-wrt.com/'&gt;DD-WRT&lt;/a&gt; and &lt;a href='http://www.polarcloud.com/tomato'&gt;tomato&lt;/a&gt;. Reading a bit about the two I found that people seems to praise how simple, yet powerfull, tomato is, and I found the DD-WRT documentation to be somewhat confusing.&lt;/p&gt;

&lt;h2 id='one_foot_in_front_of_the_other'&gt;One foot in front of the other&lt;/h2&gt;

&lt;p&gt;This is the steps I went through to change the firmware of my Netgear N300 WNR3500lv1 router.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Save your router configuration, and note down any port forwarding you have setup. (The backup file is in a binary format, so you cannot read the values from that.)&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Since this is guide starts with a stock router running the original firmware we need to start with the DD-WRT firmware and update from that. Download &lt;a href='http://www.myopenrouter.com/download/18896/NETGEAR-WNR3500L-DD-WRT-Firmware-Special-File-for-Initial-Flashing/'&gt;Special DD-WRT Firmware for initial flashing&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Go to Router Upgrade and upgrade to the DD-WRT firmware&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Wait for the upgrade to finish&lt;/li&gt;

&lt;li&gt;Wait just a bit more make sure the upgrade has finished&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Power off the router. Then use a pen to push the &lt;em&gt;restore factory setting&lt;/em&gt; button. While keeping it pressed down, power on the router, and keep pressing the restore button for 30 seconds.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;This should make your router boot properly and you should now be back on the interwebs.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Download the firmware you want to upgrade to, I choose the &lt;a href='http://www.myopenrouter.com/download/list?cat=50'&gt;tomato firmware&lt;/a&gt;.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;I had to rename the firmware file from &lt;code&gt;.trx&lt;/code&gt; to &lt;code&gt;.bin&lt;/code&gt; which is the DD-WRT update extension.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Go to &lt;a href='http://192.168.1.1/'&gt;http://192.168.1.1/&lt;/a&gt; and find administration -&amp;gt; Firmware upgrade. Upgrade to your desired firmware&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;As a quick sidenote, dd-wrt actually looked nice, but I had choosen to give tomato a spin.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Wait for the upgrade to funish, it should end up with a continue button. Clicking it will propt you with a password popup for &amp;#8220;DD-WRT&amp;#8221;, ignore this.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Power off the router. Then use a pen to push the &lt;em&gt;restore factory setting&lt;/em&gt; button. While keeping it pressed down, power on the router, and keep pressing the restore button for 30 seconds.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Now you should be able to login to your router, except toastman (the guy who packages the tomato firmware) decided that turning off the dhcp server was an awsome idea. So just enable it under basic -&amp;gt; network&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;To ensure everything is dandy please go to &lt;a href='http://192.168.1.1/admin-config.asp'&gt;http://192.168.1.1/admin-config.asp&lt;/a&gt; and choose &lt;em&gt;Erase all data in NVRAM memory (thorough)&lt;/em&gt; under the &lt;em&gt;Restore Default Configuration&lt;/em&gt; section.&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;
&lt;p&gt;Enjoy your newly flashed router, and happy configuration :D&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id='troubleshooting'&gt;Troubleshooting:&lt;/h2&gt;

&lt;p&gt;How to see the version of my n300 router? Scroll down in the menu to the knowledge base link, this link contains the router version, mine was &lt;a href='http://support.netgear.com/product/WNR3500Lv'&gt;http://support.netgear.com/product/WNR3500Lv1&lt;/a&gt;, so a version 1 WNR3500l router.&lt;/p&gt;

&lt;h2 id='future_improvements'&gt;Future improvements..&lt;/h2&gt;

&lt;p&gt;The short ammount of time I spent in dd-wrt was actually not that bad, depending on the stability of the tomato firmware I might jump back to DD-WRT. I found it more visually pleasing than tomato and especially the stock firmware.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>JS app frameworks</title>
   <link href="http://casadelkrogh.dk/code/2012/07/08/js-app-frameworks"/>
   <updated>2012-07-08T00:00:00+02:00</updated>
   <id>hhttp://casadelkrogh.dk/code/2012/07/08/js-app-frameworks</id>
   <content type="html">&lt;p&gt;In order to brush off my JS skills a bit I want to build a small HTML5 app, for mobile and desktop use. As not to start from scratch I poked around in the toolbox for frameworks to use.&lt;/p&gt;

&lt;p&gt;I take a 10.000 km overview of &lt;a href='http://emberjs.com/'&gt;ember.js&lt;/a&gt;, &lt;a href='http://backbonejs.org/'&gt;backbone.js&lt;/a&gt;, and &lt;a href='http://spinejs.com/'&gt;spine.js&lt;/a&gt; for the core app development, and try to decide which testing framework to use.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 id='testing'&gt;Testing&lt;/h2&gt;

&lt;p&gt;The first thing I took a look at after chiseling out the idea was which testing framework to use. The reason for that is that my normal approach to coding often end up a bit unwieldy, and for this App I wanted to do a bit of TDD/BDD (Test driven development/Behavior driven development).&lt;/p&gt;

&lt;p&gt;I have used &lt;a href='http://docs.jquery.com/QUnit'&gt;QUint&lt;/a&gt;, the jQuery unit testing framework before, and it is a nice unit testing framework. When I write ruby code I have grown fond of &lt;a href='http://rspec.info/'&gt;Rspec&lt;/a&gt; which is a BDD style testing framework. Therefore I have had an eye at the &lt;a href='http://pivotal.github.com/jasmine/'&gt;Jasmine&lt;/a&gt; testing framework for some time.&lt;/p&gt;

&lt;p&gt;These are the only two testing frameworks I have chosen to look at, I am sure there are a lot of other brilliant frameworks, but these two fit my needs.&lt;/p&gt;

&lt;h3 id='qunit'&gt;QUnit&lt;/h3&gt;

&lt;p&gt;A simple, well documented, unit testing framework used to keep the jQuery code working. Instead of showing off some tests here it is way easier to point to the &lt;a href='http://docs.jquery.com/QUnit#Using_QUnit'&gt;official documentation&lt;/a&gt;, which as stated is more than enough to get started.&lt;/p&gt;

&lt;p&gt;Tests run in a dedicated HTML page that outputs a nice overview of the test results.&lt;/p&gt;

&lt;h3 id='jasmine'&gt;Jasmine&lt;/h3&gt;

&lt;p&gt;As mentioned Jasmine has a lot of similarity to Rspec, it allows you to describe and test features as a set of test cases. Again the documentation of this testing framework is ace, allowing me to just point at it and be done with it &lt;a href='http://pivotal.github.com/jasmine/'&gt;jasmine example&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The most irritating thing about jasmine is that it was not very straight forward where the distributable could be downloaded, but then again I could just have read the entire introduction. The download link is at the way bottom, and includes a nice template for getting up and running.&lt;/p&gt;

&lt;p&gt;Just like QUnit the tests can be run from a dedicated HTML page, which is nice e.g. for testing in multiple browsers.&lt;/p&gt;

&lt;h3 id='choosing_a_testing_framework'&gt;Choosing a testing framework&lt;/h3&gt;

&lt;p&gt;I have ended up choosing Jasmine as it resembles Rspec. Only time will tell if it is a good choice or if I end up backtracking.&lt;/p&gt;

&lt;h2 id='javascript_framework'&gt;JavaScript framework&lt;/h2&gt;

&lt;p&gt;After choosing a testing framework I set out to find a suitable JS framework. I have mostly rolled my own MVC up until now, but I am a great fan of building on top of other peoples work, as it often means you can focus on the functionality rather than the nuts and bolts/stitching of the App.&lt;/p&gt;

&lt;p&gt;So I feel like it is time to to bring in the cavalry, but when you are somewhat used to looking under the hood you get a bit picky. I have played around with Backbone.js before and liked many of the things it enables you to do, and the freedom you get. I have also had my eye on ember.js for some time, and the vision of spine.js has had me intrigued.&lt;/p&gt;

&lt;p&gt;There are other frameworks out there, e.g. &lt;a href='http://angularjs.org/'&gt;angular.js&lt;/a&gt; by some Googler&amp;#8217;s, but I have chosen to look at these three frameworks because they fit my idea of how a JS framework should be.&lt;/p&gt;

&lt;h3 id='backbonejs'&gt;Backbone.js&lt;/h3&gt;

&lt;p&gt;Backbone.js is a bare bone lightweight MVC framework developed as a part of the DocumentCloud project. It clocks in at 5.6kb minified which is impressive, it does however require Undersocore.js which adds 4kb, json2 (1kb), and for DOM manipulation jQuery (32kb) or Zepto (8.4kb). I will probably end up including jQuery anyway, so excluding that payload the Backbone.js setup clocks in at about 11kb, which is very impressive.&lt;/p&gt;

&lt;p&gt;Backbone.js provides base methods for creating Models, Collections, Controllers, Views and more. It leaves it up to you how to connect the dots, but it also gives you a lot of documentation and a healthy community to get you up and running.&lt;/p&gt;

&lt;h3 id='emberjs'&gt;Ember.js&lt;/h3&gt;

&lt;p&gt;Ember.js was created by Tom Dale and Yehuda Katz as a reboot of SproutCore done from the ground up with focus on removing developer frustrations. On a slight side note Katz is one of the core Rails guys, who did a lot of work on the Rails 3.&lt;/p&gt;

&lt;p&gt;With this pedigree it should prove to be an interesting framework, and on the face of it, it is. Ember.js comes with auto-updating views, meaning that when your models are updated all the relevant views will be re-rendered. This is a cool feature, it does however force you to use handlebars, the Ember.js template language, which is fine. Handlebars is a mustache based template language designed to be potent and leverage template caching.&lt;/p&gt;

&lt;p&gt;All in all Ember.js is sporting some nice features. The big drawback is the documentation, which is either out of date or simply missing, and often out of sync with the current implementation.&lt;/p&gt;

&lt;h3 id='spinejs'&gt;Spine.js&lt;/h3&gt;

&lt;p&gt;As far as I remember Spine.js was created as a Backbone.js done right. It sports a lot of philosophy and pattern ideas. One being that the interface must be non-blocking, which is bold and brave, but nice to see.&lt;/p&gt;

&lt;p&gt;Spine.js projects are encouraged to follow a Rails like layout, and comes with a set of node.js tools that makes project creation easy. It encourages developing using coffeescript, which is somewhat awesome, but has its limitations.&lt;/p&gt;

&lt;p&gt;Spine.js also have fairly good documentation along with some screen casts. The hem development server seems nice, allowing you to make proper integration testing right from your dev machine, without having to setup a server.&lt;/p&gt;

&lt;h3 id='choosing_a_js_framework'&gt;Choosing a JS framework&lt;/h3&gt;

&lt;p&gt;I chose ember.js because I like Handlebars, and some of the ideas behind the framework. However after fiddling around, trying to do even simple tasks such as setting up a new model I became increasingly frustrated with the inconsistency of the documentation.&lt;/p&gt;

&lt;p&gt;The front page sports a quick sweet siren song example, but no other pinpointers. The documentation page does not show how to use the &lt;code&gt;DS.Model&lt;/code&gt; (datasource), and the API contains absolutely nothing of value to beginners.&lt;/p&gt;

&lt;p&gt;The boilerplate start you can download contains no scaffolding what so ever, not even a simple Hello person app. If it just contained a simple app with a model, controller and a view you would probably be able to get going fairly quickly.&lt;/p&gt;

&lt;p&gt;This lack of a best practice guideline makes me a sad panda, and it means I will probably make the first prototype using Backbone.js. I am however adamant that I will return to ember.js at some point, perhaps redo the app in ember.js at a later time.&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Creating a ruby project</title>
   <link href="http://casadelkrogh.dk/code/2012/04/20/creating-a-ruby-project"/>
   <updated>2012-04-20T00:00:00+02:00</updated>
   <id>hhttp://casadelkrogh.dk/code/2012/04/20/creating-a-ruby-project</id>
   <content type="html">&lt;p&gt;Setting up a new project is not necessarily something one does every day. The process always include some hoops and loops, along with spying on the previous projects one has created. Well at least thats how it is for me, at work however we keep some information on project initialization in a wiki. But as a single person a wiki feels like overkill, and it is often a lot less likely to be found by and help other people.&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;I have started a few ruby projects so far, and I have become a great fan of &lt;a href='http://gembundler.com/'&gt;bundler&lt;/a&gt; mostly due to the rails development I have been doing. With bundler, dependency management becomes a breeze, just as it should be. Starting a new project using bundler means running:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bundle init&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This creates a nice &lt;code&gt;Gemfile&lt;/code&gt; in your project ready to add your external gems, but more much more than this it allows you to use &lt;code&gt;Bundler.require(:default)&lt;/code&gt;. With that awesome bit of code your local &lt;code&gt;lib/&lt;/code&gt; dir will be required. This means you can concentrate on writing awesome code, instead of fighting with linking it together.&lt;/p&gt;

&lt;p&gt;In short a typical project main file, preferably called &lt;code&gt;{project-name}.rb&lt;/code&gt;, would look like this, where &lt;code&gt;{project-name}&lt;/code&gt; is the name of your project:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;require &amp;quot;rubygems&amp;quot;
require &amp;quot;bundler/setup&amp;quot;

Bundler.require(:default)
require &amp;quot;{project-name}&amp;quot;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To make this main file work you will need to create the folder &lt;code&gt;lib/&lt;/code&gt; and add another &lt;code&gt;{project-name}.rb&lt;/code&gt; file.&lt;/p&gt;

&lt;h2 id='go_ahead_and_test_it'&gt;Go ahead and test it&lt;/h2&gt;

&lt;p&gt;Really, you should make some test cases. Some people like TDD red-green testing, others like to write test cases when the functionality is present. Any which way you like to test is fine by me, personally I always end up mixing red-green testing and follow up testing. The most important thing is to actually add tests!&lt;/p&gt;

&lt;p&gt;I have grown fond of &lt;a href='http://rspec.info/'&gt;Rspec&lt;/a&gt; lately, and find its DSL awesome. Therefore we shall look at how to add a some Rspec test cases to a new project. Start by adding &lt;code&gt;gem &amp;quot;rspec&amp;quot;&lt;/code&gt; to the &lt;code&gt;Gemfile&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&amp;#8230; To be continued (sorry, forgot I started writing this post, I might return to it later).&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Backup, backup, backup</title>
   <link href="http://casadelkrogh.dk/tech/2012/03/24/backup-backup-backup"/>
   <updated>2012-03-24T00:00:00+01:00</updated>
   <id>hhttp://casadelkrogh.dk/tech/2012/03/24/backup-backup-backup</id>
   <content type="html">&lt;p&gt;Backup is something you always wish you had, when you have had a system failure. Sometimes you have a backup, but no way to restore it quickly. If done right backup can be a godsend, but backups are not just for system failures.&lt;/p&gt;

&lt;p&gt;During some spring cleaning when I moved to a new &lt;abbr title='Virtual Private Server'&gt;VPS&lt;/abbr&gt; recently I ended up needing my backup as I had not gotten round to move everything. But my backup/archive turned out not to be that recent. This however gave me an excuse to play around with the &lt;a href='https://sm.beginrescueend.com/'&gt;SM Framework&lt;/a&gt;, a shell scripting abstraction devised by &lt;a href='https://twitter.com/#!/wayneeseguin'&gt;Wayne E. Seguin&lt;/a&gt; and &lt;a href='https://twitter.com/#!/mpapis'&gt;Michal Papis&lt;/a&gt;.&lt;/p&gt;
&lt;!--more--&gt;&lt;aside class='right span2 well'&gt;I have a VPS at &lt;a href='http://www.hosteurope.de/'&gt;Host Europe&lt;/a&gt;, which btw. is an awesome German based hosting firm. They provide a service where you can upgrade your VPS for free, and when you upgrade from an older series to a newer series you get 7 days as a transfer period. During these 7 days you have access to two VPSs, your current and your future VPS. You are in charge of moving everything to the new VPS yourself. This is great if you want to change something in your production setup.&lt;/aside&gt;
&lt;h2 id='but_why'&gt;But why?&lt;/h2&gt;

&lt;p&gt;The reason for giving the SM Framework a go was because I personally find sh scripting a pain to read and write. SM provides a tonne of abstractions that make it easier to follow what the script is doing.&lt;/p&gt;

&lt;p&gt;Initially I had some problems getting the SM Framework up and running, this was mainly due to the lack of updated documentation, or rather; The framework was undergoing a name change, from bdsm to SM Framework, and the site did not really reflect the changes, and a lot of the pages were missing. Luckily Michal Papis was at hand on the #beginrescueend irc channel on freenode and patiently answered my questions and helped me get SM up and running.&lt;/p&gt;

&lt;p&gt;Michal Papis had actually made a bdsm extension called &lt;a href='https://github.com/mpapis/sm_backup'&gt;sm_backup&lt;/a&gt; that covered a lot of standard backup stuff, such as shorthand functions for using mysqldump, rsync data and file rotation. I was however not able to get it to work on the newer version of the SM framework (0.10.2). Papis did offer to look into fixing the extension, but said he did not actively use it.&lt;/p&gt;

&lt;p&gt;Since my needs were quite basic there were no reason to try and rush the extension update, and I therefore went about and dabbled with creating my own set of functions whilst looking closely, and trying to learn from the functions in sm_backup.&lt;/p&gt;

&lt;h2 id='documentation'&gt;Documentation&lt;/h2&gt;

&lt;p&gt;As mentioned the documentation at the time of writing is a bit sparse, but one of the things I can recommend is to install the &lt;code&gt;apidoc&lt;/code&gt; extension.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sm ext install apidoc&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;With the apidoc installed you can now run:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sm apidoc paths create&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Which will output:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# path(s) module api is loaded with the line &amp;#39;api/paths&amp;#39; in shell/includes.

# Now we will create a path
path create /tmp/paths/remove

# Now let&amp;#39;s checkout the path and it&amp;#39;s contents,

ls -l /tmp/paths/
total 4
drwxr-xr-x 2 markus markus 4096 2012-03-24 19:37 remove

# Cleanup after ourselves
path remove /tmp/paths&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;sm apidoc&lt;/code&gt; is the little &lt;a href='http://en.wikipedia.org/wiki/The_Hitchhiker&amp;apos;s_Guide_to_the_Galaxy'&gt;HHGTTG&lt;/a&gt; of the SM framework, although it does still contain some &lt;em&gt;Add an example&lt;/em&gt; type of entries.&lt;/p&gt;

&lt;h2 id='the_power_of_sm'&gt;The power of SM&lt;/h2&gt;

&lt;p&gt;Using SM to create higher level functions is quite nice. This next example is a function that handles creation and entering a backup directory:&lt;/p&gt;

&lt;p&gt;Yes the same sh equivalent is not impossible to create, but being able to read the script afterwards is simply fantastic.&lt;/p&gt;

&lt;h3 id='backing_up_mysql'&gt;Backing up mysql&lt;/h3&gt;

&lt;p&gt;The simple answer is just use &lt;code&gt;mysqldump&lt;/code&gt; and be done with it, but wrapping it up in a function can make it much simpler to work with it.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# usage:
#   dump_mysql [db_name] [mysql_opts] [backup_file]
# db_name defaults to $NAME
# db_params defaults to &amp;#39;-ubackup&amp;#39;
# backup_file defaults to &amp;#39;$db_name&amp;#39;_db-
function dump_mysql() {
  local db_name=${1:-$NAME}
  local mysql_opts=${2:--ubackup}
  local backup_file=${3:-$db_name\_db-}
  local file=&amp;quot;$backup_file$(today).sql.gz&amp;quot;
  
  log step &amp;quot;Dumping database to $file&amp;quot;
  mysqldump $mysql_opts $db_name | gzip -c &amp;gt; $file
  if file exists $file
  then
    log step success
  else
    log step fail
  fi
}&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This function adds defaults that I find useful, e.g. figure out the backup file name based on input, but still allow you to define it if necessary.&lt;/p&gt;

&lt;p&gt;The log function is fantastic, and combined with log step it makes it easy to generate sane console output that change based on whether or not a function succeeds.&lt;/p&gt;

&lt;h3 id='the_rest'&gt;The rest&lt;/h3&gt;

&lt;p&gt;Now this post is heading in the direction of being overpopulated with code examples, so to keep it a bit more tidy I will just add my backup.sh file at the &lt;a href='#files'&gt;bottom of this post&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id='putting_it_together'&gt;Putting it together&lt;/h2&gt;

&lt;p&gt;The final concrete backup script ends up looking like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#!/usr/bin/env sm

includes &amp;quot;api/filesystem&amp;quot;
includes &amp;quot;api/paths&amp;quot;

. ./functions/backup.sh

backup_dir &amp;quot;db_backup&amp;quot;
dump_mysql &amp;quot;nice_db&amp;quot;
rotate &amp;quot;nice_db&amp;quot;&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id='just_add_cron'&gt;Just add CRON&lt;/h3&gt;

&lt;p&gt;All that is left is to add this script to CRON on the server I wish to backup. And of cause add another script that uses rsync to retrieve the backups.&lt;/p&gt;

&lt;p&gt;To use the SM framework from CRON you will have to set your CRON path, first find out what your current path contains:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;echo $PATH&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then add this string to your CRON file, &lt;code&gt;crontab -e&lt;/code&gt; as:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;PATH=THAT_INSANELY_LONG_PATH&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id='not_using_bash'&gt;Not using bash&lt;/h2&gt;

&lt;p&gt;Another challenge I had was that just the day before I decided to use the SM framework I had changed my shell to &lt;a href='http://www.zsh.org/'&gt;zsh&lt;/a&gt;. The default SM installer sets up a lot of stuff for you, such as adding SM to &lt;code&gt;/etc/profile.d/&lt;/code&gt; which bash includes in its environment setup. A newly installed zsh however does not, as not to impose any preferences onto you. So after countless questions back and forth with a very patient Michal Papis I got it working.&lt;/p&gt;

&lt;p&gt;I ended up just sourcing SM in my &lt;code&gt;~/.zshrc&lt;/code&gt; file, this is perhaps not the ideal place, but it works for now:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#load sm
. /etc/profile.d/sm.sh&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id='ahh_now_safe_no_longer_sorry'&gt;Ahh now safe, no longer sorry&lt;/h2&gt;

&lt;p&gt;All in all, using the SM framework has probably taken longer than to just crank out a standard shell script, but the framework definitely has some potential. And if you embrace it fully and create your own extension etc. then the re-usability will be awesome.&lt;/p&gt;

&lt;p&gt;But now my files are safe again, my database is being backuped and all that remains would be to run a restore firedrill, but given the simplicity of my setup that wont be necessary, I can live with being offline for a day.&lt;/p&gt;

&lt;h2 id='files'&gt;Files&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href='/files/backup.sh'&gt;backup.sh&lt;/a&gt; - functions to use in a backup script.&lt;/li&gt;
&lt;/ul&gt;</content>
 </entry>
 
 <entry>
   <title>A theme, a dream and some bumps</title>
   <link href="http://casadelkrogh.dk/tech/2012/03/17/a-theme-a-dream-and-some-bumps"/>
   <updated>2012-03-17T00:00:00+01:00</updated>
   <id>hhttp://casadelkrogh.dk/tech/2012/03/17/a-theme-a-dream-and-some-bumps</id>
   <content type="html">&lt;p&gt;So after a days work or so the theme is coming along, as mentioned before the theme is based on &lt;a href='http://twitter.github.com/bootstrap/'&gt;Twitter Bootstrap&lt;/a&gt;. The background image still needs some work, but my GIMP skills seems to have rusted a bit.&lt;/p&gt;

&lt;p&gt;However I must say the responsive design extension to bootstrap is quite nice. (Why has it not been named &lt;em&gt;adaptive design&lt;/em&gt; rather than &lt;em&gt;responsive design&lt;/em&gt;?)&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;I have also added some sweet sweet Haml and Sass support. The Sass support was possible to implement via a Jekyll Converter, Haml however ended up as a &lt;code&gt;rake haml&lt;/code&gt; task. The reason behind the rake task is the way Jekyll handles the &lt;code&gt;_&lt;/code&gt; folders, it does not process these folders, and it makes most sense to place my haml files in the theme folder.&lt;/p&gt;

&lt;p&gt;The Sass converter is mostly based on a gist I found https://gist.github.com/960150. To enable Sass partials I had to specify my full theme path, however I am quite sure it is possible to derive it from the &lt;code&gt;_config.yml&lt;/code&gt; or the Jekyll configuration. Also the Sass files have to start with a &lt;em&gt;YAML Front Matter&lt;/em&gt; block in order to be processed automagically.&lt;/p&gt;

&lt;p&gt;Other than than I have made a couple of small liquid filters, a read-more filter that triggers on &lt;code&gt;&amp;lt;!--more--&amp;gt;&lt;/code&gt; and a simple &lt;code&gt;or&lt;/code&gt; filter, which could be seen as an attempt to make a simple &lt;em&gt;default to a piece of text&lt;/em&gt; if &lt;code&gt;nil&lt;/code&gt; or empty.&lt;/p&gt;
&lt;p&gt;&lt;span class='label label-info'&gt;Update&lt;/span&gt; Hmm it seems like my nice Sass trick makes Jekyll believe that my css file is a page :(&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Jekyll seems usable</title>
   <link href="http://casadelkrogh.dk/2012/03/11/jekyll-seems-usable"/>
   <updated>2012-03-11T00:00:00+01:00</updated>
   <id>hhttp://casadelkrogh.dk/2012/03/11/jekyll-seems-usable</id>
   <content type="html">&lt;p&gt;It would seem like the jekyll parsing engine might be a nice way to publish blog posts&amp;#8230; By using jekyll and maybe github things will be easier than ever.&lt;/p&gt;

&lt;p&gt;The current state of available designs is a bit underwhelming but that is somewhat to be expected. I think I will be expanding the default twitter bootstrap theme, since it is the best starting point for me, might make sense to use html5 boilerplate instead only time will tell.&lt;/p&gt;

&lt;p&gt;But all in all I think I am going to enjoy using jekyll.&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 id='why_use_jekyll'&gt;Why use Jekyll?&lt;/h2&gt;

&lt;p&gt;The main reason for using jekyll for this blog is quite simply the joy of new technology, the exact same reason why I started the blog. I enjoy new technology, and I love to learn new things, so having dabbled with rails for some time I thought I wanted to revive my CasaDelKrogh blog.&lt;/p&gt;

&lt;p&gt;Last time (2008ish) it sort of died in setting up the blog, at the time I was trying to use Drupal, then Wordpress. Both worked fine, but I am not really into maintaining yet another piece of software, and at the time I had allready started to turn my back on php.&lt;/p&gt;

&lt;p&gt;The idea behind Jekyll is appealing, no actual dynamic content on the actual server, just a bunch of pre-compiled html files. A blog does, in my opinion, not need to be dynamic, this is why people use hosted solutions such as Wordpress, blogger or Tumblr. It is all about making it easier for you as a blogger to write content, and for that I believe Jekyll will be quite sufficient for me.&lt;/p&gt;</content>
 </entry>
 
 
</feed>